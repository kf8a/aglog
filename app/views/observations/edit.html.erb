<h1>Edit observation</h1>

Created on: <%= @observation.created_on  %>

 <div ng-app='Aglog' data-observation-id = <%= @observation.id %> >

  <div ng-controller='NewCtrl' data-observation-id = <%= @observation.id %> >
    <%= form_for @observation, :method=>:put  do |form| %>
    <label>Observation Date</label>
    <input type="text" name='observation[observation_date]' datepicker-popup="dd-MMMM-yyyy" ng-model="obs.obs_date"
      ng-required=true show-weeks=false is-open="opened" datepicker-options="dateOptions" />

    <label>Observation</label>
    <textarea id='observation_comment' name='observation[comment]' class='span6' ng-model='obs.comment' placeholder='describe what happened'></textarea>

    <label>Areas</label>
    <select ui-select2 ng-model='selectedArea' class='input-large' placeholder='select an area' ng-change='updateAreaTags()'>
      <option value=''></option>
      <option ng-repeat='area in areas' value={{area.id}}>{{area.text}}</option>
    </select>
    <input id='areaSelect' type="text"  ui-select2="tagAllOptions" ng-model="tagsSelection" class="input-xlarge"/>

    <label id='observation-type-label' class='clearfix'>Observation Type</label>

    <label ng-repeat='observation_type in obs.observation_types'>
      <input type='checkbox' name='observation[observation_type_ids][]' value='{{observation_type.id}}' ng-model="observation_type.checked"/>
      <span>{{observation_type.name}}</span>
    </label>

    <ul class='unstyled'>
      <li class='well' ng-repeat="activity in obs.activities">
      <button type='button' ng-click="removeActivity($index)" class="close">&times;</button>
      <label>Person</label>
      <select name='observation[activities_attributes][][person_id]' ng-model="activity.person" ng-selected="0" ng-options="person as person.name for person in obs.people track by person.id">
        </select>
      <div>
        <ul class='unstyled'>
          <li class='well' ng-repeat="setup in activity.setups">
          <button type='button' ng-click="removeEquipment(activity, $index)" class="close">&times;</button>

          <label>Equipment</label>
          <select ng-model='setup.equipment' ng-options="equip as equip.name for equip in obs.equipment track by equip.id">
          </select>
          <div>
            <ul class='unstyled'>
              <li ng-repeat="material in setup.material_transactions">
              <div class='well well-small form-inline'>
                <button type='button' ng-click="removeMaterial(setup, $index)" class="close">&times;</button>
                <label>Material</label>
                <select ng-model='material.material' ng-options="m as m.name for m in obs.materials track by m.id">
                </select>
                <input type='number' step='0.01' class='input-mini' ng-model='material.amount'></input>
                <select ng-model='material.unit' ng-options="unit as unit.name for unit in obs.units track by unit.id">
                </select>
                <label>per Acre</label>
              </div>
              </li>
            </ul>
          </div>
          <button type='button' ng-click="addMaterial(setup)">Add Material</button>
          </li>
        </ul>
      </div>
      <button type='button' ng-click="addEquipment(activity)">Add Equipment</button>
      </li>
    </ul>

    <button type='button' ng-click="addActivity()">Add Activity</button>
    <button type='button' ng-click='addFile()'>Add File</button>
    <button type='submit'>Submit</button>
  <% end %>
</div>
<div>


<%= link_to 'Show', observation_path(@observation) %> |
<%= link_to 'List Observations', observations_path %>
